一.红帽认证架构师-RHCA 官方介绍
红帽®认证架构师（RHCA）是红帽的最高级别认证，IT 人员在通过红帽认证工程师（RHCE®）、红帽认证企业微服务开发人员（RHCEMD）或红帽认证 JBoss® 开发人员（RHCJD）认证后，还需再通过系统管理员和开发人员认证列表中的五项额外认证（并保持有效认证状态）方可获得。
红帽提供两种不同的红帽认证架构师认证路径：红帽基础架构认证架构师和红帽企业应用认证架构师。申请人可以同时选择这两条认证路径，也可选择参加 RHCA 认证路径中未包含的考试。

二.申请人已通过 RHCE 规划 RHCA 路径
RHCA 认证非常适合已获得红帽认证工程师（RHCE）资格，并希望掌握更多有关红帽企业 Linux 及其他红帽产品知识和技能的人士。
RHCE 可以自由选择基础架构 RHCA 列表中的任意认证组合，而取得“技能”标签页的系统管理员认证列表中的五个或更多证书，则可成为红帽基础架构认证架构师。
除了基本证书外，再获得五个以上的证书，即可获得更高级别的 RHCA 证书。例如，在 RHCD、RHCEMD 或 RHCJD 的基础上再获得六个证书，就可以获得二级 RHCA 认证（前提是这六个证书在有效期内）。如其中一个证书失效，RHCA 将恢复为一级；如果再有一个失效，将不再具有 RHCA 资格。

推荐的认证组合：

1.开放混合云计划
我们相信开放混合云代表着企业计算的现在和未来。对敏捷性、灵活性和成本控制的需求，强调了多种备选方案的重要性。
要把企业以最符合业务要求的方式融入云端，需要获得以下认证中的五项：
    红帽认证混合云管理专家
    红帽认证 Gluster 存储管理专家
    红帽认证虚拟化专家
    红帽认证 OpenShift 管理专家
    红帽 OpenStack 红帽认证系统管理员
    红帽认证部署和系统管理专家

2.DevOps、容器和 OpenShift 计划
容器正在改变着应用的开发、测试和部署方式，而红帽® OpenShift 容器平台正是红帽的容器处理环境。
对于希望缩短应用开发周期的企业，容器是绝佳之选。不过，创建持续集成/连续交付（CI/CD）管道需要的不仅仅是容器，还需要实现自动化。DevOps 提供了一种自动化方法，它不仅能将旧应用与更新的云原生应用和基础架构进行关联，而且还可以通过快速迭代 IT 服务交付来实现同样目的。
我们的 DevOps、容器和 OpenShift 的推荐方案中还包括了培训，这些培训关系着能否在当今应用需求剧增的世界中取得成功。获得以下四个证书，外加系统管理员认证列表中的一个证书，将有助于改变企业向客户交付应用的方式。
    红帽认证 OpenShift 管理专家
    红帽认证 Ansible 自动化专家
    红帽认证配置管理专家
    红帽认证 API 管理专家
    红帽认证高级自动化专家：Ansible 最佳实践
    红帽认证容器和 OpenShift 容器平台安全专家

3.电信云计划
软件定义的网络（SDN）和网络功能虚拟化（NFV）正在改变电信行业，以基于虚拟化的灵活解决方案取代了较旧的、基于硬件的不灵活解决方案。红帽 OpenStack 平台和其他红帽技术是当今和未来电信行业必不可少的构建基础。必须获得以下认证，来验证当今的电信 IT 专业人员所需的技能和知识。
    红帽 OpenStack 红帽认证系统管理员
    红帽 OpenStack 红帽认证工程师
    红帽认证 Ceph 存储管理专家
    红帽认证 Ansible 自动化专家
    红帽认证配置管理专家
    红帽认证高级自动化专家：Ansible 最佳实践

4.精通 Linux 计划
红帽® 企业 Linux® 的可靠性、可扩展性、性能和可管理性构成了诸多红帽技术的核心。我们不会轻易使用“精通”一词——它代表了深入研究并专注于 Linux。请在以下认证中选择五项：
    红帽认证 Linux 诊断和故障排除专家
    红帽认证 Linux 性能调优专家
    红帽认证服务器安全与加固专家
    红帽认证身份管理专家
    红帽认证高可用性集群专家
    红帽认证部署和系统管理专家
    红帽认证高级自动化专家：Ansible 最佳实践
    红帽认证 Linux 安全专家

三.首先从红帽认证 Ansible 自动化专家、红帽认证高级自动化专家：Ansible 最佳实践开始学习
1.红帽认证 Ansible 自动化专家

技能与知识，获得红帽 Ansible 自动化专业技能证书的 IT 专业人员能够执行以下任务：
    使用 Ansible 清单 (inventory) 定义主机组
    创建 Ansible playbook
    使用 playbook，将系统配置为指定的状态
    创建和使用 Ansible 模板来为主机创建自定义的配置文件
    创建 Ansible 角色
    利用 playbook 中的 Ansible Vault 保护敏感数据
    安装 Ansible Tower 并用它来管理系统

以下人士可能有兴趣考取红帽 Ansible 自动化专业技能证书：
    需要管理大量系统的系统管理员
    在 DevOps 环境中工作、并想实现大部分日常作业量自动化的系统管理员
    具有基本系统管理背景、并想实现开发流程自动化的开发人员
    有兴趣获得红帽专业技能证书或 RHCA 证书的 红帽认证工程师 (RHCE®)) 。

红帽 Ansible 自动化专业技能证书考试 (EX407)，通过此项考试的 IT 人士将获得红帽专业技能证书，并将计入红帽认证架构师的认证成绩中。 

考试概述
红帽认证 Ansible 自动化专家考试（EX407）旨在测试您运用 Ansible 实现系统和应用配置自动化的能力。
通过此项考试后，您将成为红帽认证 Ansible 自动化专家，并将计入红帽认证架构师（RHCA）的认证成绩中。
本课程基于红帽® 企业 Linux® 7.5 和 Ansible 2.7。
现在，此项考试涵盖的材料包含在红帽认证工程师 (RHCE) 考试 (EX294) 的课程中。此项新考试旨在测试您能否使用红帽 Ansible 自动化使不同功能实现自动化并有效扩展基础架构。
考核对象
    需要管理大量系统的系统管理员
    在 DevOps 环境中工作、并想实现大部分日常作业量自动化的系统管理员
    具有基本系统管理背景、并想实现开发流程自动化的开发人员
    有兴趣成为红帽认证专家或红帽认证架构师（RHCA）的红帽认证工程师（RHCE）
考试前提条件
    成功完成利用 Ansible 实现自动化（DO407）课程，或具有使用 Ansible 配置系统的同等经验
    建议先成为红帽认证系统管理员（RHCSA）或具有同等或更高的系统管理经验，但不强制要求

考查要点
我们建议考生在参加此项考试前先成为红帽认证工程师（RHCE®）或至少成为红帽认证系统管理员（RHCSA®），但两者并不强制要求。为了帮助您备考，请查看本文给出的考试目标，其中列出了操作任务的考查范围。红帽保留添加、更改和删除考试目标的权利。此类变更将在考前公布。
您应能够：
    了解 Ansible 的核心组件
        Inventory（配置文件）
        模块
        变量
        Fact
        Play
        Playbook
        配置文件
    安装和配置 Ansible 控制节点
        安装所需软件包
        创建静态主机 inventory 文件
        创建配置文件
    配置 Ansible 托管的节点
        创建 SSH 密钥并将其分配给托管节点
        在托管节点上配置权限提升
        使用 ad-hoc Ansible 命令验证有效配置
    创建运行 ad hoc Ansible 命令的简单 shell 脚本
    使用静态和动态 inventory 定义主机群组
    使用现有的动态 inventory 脚本
    创建 Ansible play 和 playbook
        了解如何使用常用的 Ansible 模块
        使用变量检索命令运行的结果
        使用条件控制 play 的执行
        配置错误处理
        创建 playbook，将系统配置为指定的状态
    使用 Ansible 模块执行有关以下内容的系统管理任务：
        软件包和存储库
        服务
        防火墙规则
        文件系统
        存储设备
        文件内容
        归档
        计划任务
        安全性
        用户和群组
    创建和使用模板来创建自定义的配置文件
    使用 Ansible 变量和 fact
    创建和使用角色
    从 Ansible Galaxy 下载角色并使用
    并行管理
    利用 playbook 中的 Ansible Vault 保护敏感数据
    使用提供的文档查找有关 Ansible 模块和命令的特定信息
对于所有实际任务操作型的红帽考试，您的所有系统配置必须在重启后仍然有效（无需人工干预）。

我们基于以上建议，正式开始进入Ansible 自动化专家的概念学习与实际操作吧。

我的物理主机配置：华南金牌X58主板，Xeon(R) CPU X5690 ，GeForce GTX 1060 6GB，32GB内存，275GB固态。
操作系统是Red Hat Enterprise Linux Server 7.9 update。
虚拟机采用了VMware® Workstation 16 Pro。
我准备利用5台本地虚拟机，1台树莓派4B和1台阿里云云主机来搭建出共计7个托管节点操作环境。
从红帽官网下载安装镜像文件：
Red Hat Enterprise Linux 8.3 Binary DVD
最新修改的:
    2020-10-14
SHA-256 Checksum:
    30fd8dff2d29a384bd97886fa826fa5be872213c81e853eae3f9d9674f720ad0 
 Red Hat Enterprise Linux 7.9 Binary DVD 
最新修改的:
    2020-09-18
SHA-256 Checksum:
    19d653ce2f04f202e79773a0cbeda82070e7527557e814ebbce658773fbe8191 

记得用sha256sum命令校验下镜像文件

物理主机叫master，update后安装以下软件包：
根据https://fedoraproject.org/wiki/EPEL#Quickstart介绍说明，导入EPEL源，有红帽账户的还可以开启额外的源
    RHEL/CentOS 7:
   # yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
    on RHEL 7 it is recommended to also enable the optional, extras, and HA repositories since EPEL packages may depend on packages from these repositories:
   # subscription-manager repos --enable "rhel-*-optional-rpms" --enable "rhel-*-extras-rpms"  --enable "rhel-ha-for-rhel-*-server-rpms"
    RHEL/CentOS 8:
   # yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
    on RHEL 8 it is required to also enable the codeready-builder-for-rhel-8-*-rpms repository since EPEL packages may depend on packages from it:
   # ARCH=$( /bin/arch )
   # subscription-manager repos --enable "codeready-builder-for-rhel-8-${ARCH}-rpms"
    on CentOS 8 it is recommended to also enable the powertools repository since EPEL packages may depend on packages from it:
   # dnf config-manager --set-enabled powertools

安装ansible和python3，依赖会自动安装。
yum install ansible-2.9.17-1.el7.noarch
yum install python3-3.6.8-18.el7.x86_64

配置master主机，使用普通用户进行操作，我这里的用户为rhel，家目录为/home/rhel。
复制ansible两个配置文件到用户目录下
cp /etc/ansible/ansible.cfg /home/rhel/
cp /etc/ansible/hosts /home/rhel/

编辑主机列表文件hosts，参考以下内容，根据实际建立主机清单文件。
vim hosts
    [webserver]
    192.168.197.128
    
    [nfsserver]
    192.168.197.129
    
    [dbserver]
    192.168.197.130
    
    [mailserver]
    192.168.197.131
    
    [dhcpserver]
    192.168.197.132
    
    [aliyun]
    allsafe.com

    [router]
    192.168.1.1

 编辑ansible配置文件ansible.cfg，参考以下内容进行修改。
 vim ansible.cfg
    inventory      = /home/rhel/hosts
    remote_user = ansiblenode
    [privilege_escalation]
    become=True
    become_method=sudo
    become_user=root
    become_ask_pass=False

生成ssh-key公私钥对，把公钥上传给托管节点。
[rhel@master ~]$ ssh-keygen -t rsa -P ''
生成的公私钥在.ssh/目录下

配置托管节点：
yum install python3
useradd ansiblenode
usermod -a ansiblenode -G wheel
passwd ansiblenode 密码为了方便都设置成一样的即可
vim /etc/ssh/sshd_config
    PermitRootLogin no
visudo
    ## Allows people in group wheel to run all commands
    # %wheel        ALL=(ALL)       ALL

    ## Same thing without a password
    %wheel  ALL=(ALL)       NOPASSWD: ALL
在主机上用命令把公钥上传给每台托管主机。
例如：ssh-copy-id -i .ssh/id_rsa.pub ansiblenode@192.168.1.101

做完以上后，我们用ansible的ping模块来检测下各个托管节点。
ansible all -m ping
成功的如下所示
192.168.1.101 | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python"
    }, 
    "changed": false, 
    "ping": "pong"
}
失败的如下所示
192.168.197.129 | UNREACHABLE! => {
    "changed": false, 
    "msg": "Failed to connect to the host via ssh: ssh: connect to host 192.168.197.129 port 22: No route to host", 
    "unreachable": true
}

用command模块输入id命令查看是以什么用户身份执行的。
ansible all -m command -a "id"
    192.168.197.128 | CHANGED | rc=0 >>
    uid=0(root) gid=0(root) 组=0(root) 环境=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
    192.168.197.130 | CHANGED | rc=0 >>
    uid=0(root) gid=0(root) 组=0(root) 环境=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
    192.168.197.132 | CHANGED | rc=0 >>
    uid=0(root) gid=0(root) 组=0(root) 环境=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
    192.168.197.131 | CHANGED | rc=0 >>
    uid=0(root) gid=0(root) 组=0(root) 环境=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
    192.168.197.129 | CHANGED | rc=0 >>
    uid=0(root) gid=0(root) 组=0(root) 环境=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
可以看到，我们虽然定义了remote_user=ansiblenode用户，但是我们实现了ansiblenode免密执行root权限的命令。





